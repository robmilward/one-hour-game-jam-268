pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
best=0

home={
 x=64,
 y=64,
 coins=0
}

player={
 x=64,
 y=64,
 lives=3,
 coins=0,
 at_home=1
}

coins={}

enemies={}


function draw_coins()
	for coin in all(coins) do
	 print("‚óè", coin.x, coin.y, 10)
	end
end

function draw_enemies()
	for enemy in all(enemies) do
		if(colliding(enemy,home,15)) then
 		print("üòê", enemy.x, enemy.y, 6)
		else
			print("üòê", enemy.x, enemy.y, 8)
		end
	end
end

function _update()
 if (btn(0)) then player.x=player.x-1 end
 if (btn(1)) then player.x=player.x+1 end
 if (btn(2)) then player.y=player.y-1 end
 if (btn(3)) then player.y=player.y+1 end

 detect_collisions()
 update_enemies()
end

function update_enemies()
	if(player.at_home == 1) then
	 return
 end

 for enemy in all(enemies) do
  if(enemy.d == 1) then
   enemy.x=enemy.x+enemy.speed 
  elseif (enemy.d == 2) then
   enemy.x=enemy.x-enemy.speed
  elseif (enemy.d == 3) then
			enemy.y=enemy.y+enemy.speed
  else
  	enemy.y=enemy.y-enemy.speed
		end
		
		if(enemy.x<=0) then
		 enemy.d=1
		end
		if(enemy.x>=120) then
		 enemy.d=2
		end		
		if(enemy.y<=0) then
		 enemy.d=3
		end
		if(enemy.y>=120) then
		 enemy.d=4
		end			
 end
end

function colliding(a, b, e)
 xhit=abs(a.x-b.x) <= e
 yhit=abs(a.y-b.y) <= e
 
 return (xhit and yhit)
end 

function _draw()
	cls()

	print("‚åÇ", home.x, home.x, 11)
	rect(58, 58, 76, 76, 3)
	draw_coins()
	draw_enemies()

	spr(1, player.x, player.y)

	print(player.coins.." coin(s), "..home.coins.." safe, "..player.lives.." lives", 0, 0, 7)
	print("best: "..best, 0, 120, 7)
end


-->8
function detect_collisions()
 pickup_coins()
 
 enemy_collide() 
 
 enter_home() 
end

function pickup_coins()
 for coin in all(coins) do
  if(colliding(coin, player, 5)) then
   sfx(0)
   del(coins, coin)
   player.coins=player.coins+1
  end
 end
end

function enemy_collide()
	for enemy in all(enemies) do
  _with_player=colliding(enemy, player, 5)
  _with_home=colliding(enemy,home,15)

	 if(_with_home and _with_player) then
	  sfx(3)
	  return
	 end
	
  if(_with_player) then
   sfx(2)
   player.coins=0
   player.at_home=1
   player.x=home.x
   player.y=home.y
   player.lives=player.lives-1
   if(player.lives == 0) then
    reset()
   end
  end
 end
end

function reset()
	player={
	 x=64,
	 y=64,
	 lives=3,
	 coins=0,
	 at_home=1
	}
	home.coins=0
	generate_coins()
	generate_enemies()
end

function enter_home()
	if(colliding(player,home,10)) then
 	if(player.at_home == 0) then
  	sfx(1)
  	generate_coins()
  	randomize_enemies()
 	end	
 	player.at_home=1
  if(player.coins > 0) then
	  home.coins=home.coins+player.coins
	  player.coins=0
	  
	  if (home.coins > best) then
	   best = home.coins
	  end
  end
 else
  player.at_home=0
 end
end	
-->8
function generate_coins()
	coins={}
 for i=0,10 do	
  repeat 
		 _coin={
		  x=ceil(rnd(120)),
		  y=ceil(rnd(120))
		 }
		until (not colliding(_coin, home, 20))

		add(coins, _coin)
	end
end

function generate_enemies()
 enemies={}
 for i=0,15 do	
	 repeat
		 _enemy={
		  x=ceil(rnd(120)),
		  y=ceil(rnd(120)),
		  d=flr(rnd(4))+1,
		  speed=rnd(1.5)+0.75
		 }
 	until (not colliding(_enemy,home,15))
	
	 add(enemies, _enemy)
	end
end

function randomize_enemies()
 for enemy in all(enemies) do
  enemy.d=flr(rnd(4))+1
		enemy.speed=rnd(1.5)+0.75
 end
end

generate_coins()
generate_enemies()
__gfx__
0000000000bbb00000aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000bbbbb000aaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007f7000aaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000fff000aaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000f111f00aaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700001110000aaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000011100000aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000a0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
77700000077007707770770007000770070000000000777000000770777077707770000000007770000070007770707077700770000000000000000000000000
70700000700070700700707070007000007000000000707000007000707070007000000000000070000070000700707070007000000000000000000000000000
70700000700070700700707070007770007000000000707000007770777077007700000000000770000070000700707077007770000000000000000000000000
70700000700070700700707070000070007007000000707000000070707070007000070000000070000070000700777070000070000000000000000000000000
77700000077077007770707007007700070070000000777000007700707070007770700000007770000077707770070077707700000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000088888880000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000080888080000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000088888880000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000080000080000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000088888880000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000088888880000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000088888880000000000000000000080888080000000000000000000000000000000000000000000000000000000000000000000
00000000000888888800000000080888080000000000000000000088888880000000000000000000000000000000000000000000000000000000000000000000
00000000000808880800000000088888880000000000000000000080000080000000000000000000000000000000000000000000000000000000000000000000
00000000000888888800000000080000080000000000000000000088888880000000000000000000000000000000000000000000000000000000000000000000
00000000000800000800000000088888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa00000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa0a0000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaa0000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaa0000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa00000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000888888800000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000808880800000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000008888888000000000000aaa00000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000800000800000000000aaa0a0000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000888888800000000000aaaaa0000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000aaaaa0000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000aaa00000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888888000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008088808000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888888000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000008000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888888000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa00000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa0a0000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaa0000000
00000088888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaa0000000
000000808880800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa00000000
00000088888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000080000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000088888880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008888888aa00000000000000000000000000000
00000000000000000000000000000000000000000000000000000000003333333333333333333000000000000080888a8a0a0000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000300000000000000000300000000000008888888aaa0000000000000000000000000000
00000000000000000000000000000000000000000000000000000000003000000000000000003000000000000080000a8aaa0000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000300000000000000000300000000000008888888aaa0000000000000000000000000000
00000000000000000000000000000000000000000000000000000000003000000000000000003000000000000000000aaaaa0000000000000000000000000000
00000000000000000000000000000088888880000000000000000000003000000000000000003000000000000000000aaaaa0000000000000000000000000000
000000000000000000000000000000808880800000000000000000000030000000bbb000000030000000000000000000aaa00000000000000000000000000000
00000000000000000000000000000088888880000000000000000000003000000bbbbb0000003000000000000000000000000000000008888888000000000000
0000000000000000000000000000008000008000000000000000000000300000bb7f7bb000003000000000000000000000000000000008088808000000000000
00000000000000000000000000000088888880000000000000000000003000000bfffb0000003000000000000000000000000000000008888888888888000000
00000000000000000000000000000000000000000000000000000000003000000f111f0000003000000000000000000000000000000008000008088808000000
00000000000000000000000000000000000000000000000000000000003000000011100000003000000000000000000000000000000008888888888888000000
00000000000000000000000000000000000000000000888888800000003000000011100000003000000000000000000000000000000000000008000008000000
000000000000000000000000000000000000000000008088808000000030000000a0a00000003000000000000000000000000000000000000008888888000000
00000000000000000000000000000000000000000000888888800000003000000000000000003000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000800000800000003000000000000000003000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000888888800000003000000000000000003000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000003000000000000000003000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000003333333333333333333000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888880000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080888080000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000088888880000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000080000000000000000000000000
00000000000000000888888800000000000000000000000000000000000000000000000000000000000000000000000088888880000000000000000000000000
0000000000000000080888080000000000000000000000000000000000000000000000000000000000aaaaa00000000000000000000000000000000000000000
000000000000000008888888000000000000000000000000000000000000000000000000000000000aaaaa0a0000000000000000000000000000000000000000
000000000000000008000008000000000000000000000000000000000000000000000000000000000aaaaaaa0000000000000000000000000000000000000000
000000000000000008888888000000000000000000000000000000000000000000000000000000000aaaaaaa0000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000aaaaa00000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000008888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000008088808000000000000000000088888880000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000008888888000000000000000000080888080000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000008000008000000000000000000088888880000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000008888888000000000000000000080000080000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000088888880000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000aaa0a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000aaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000aaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa000000000000000000000000000000000000000000
00000000000000000000000000000aaa00000000000000000000000000000000000000000000000000aaa0a0000000000000000000000000000aaa0000000000
7770777007707770000000007770aaa0a0000000000000000000000000000000000000000000000000aaaaa000000000000000000000000000aaa0a000000000
7070700070000700070000007070aaaaa0000000000000000000000000000000000000000000000000aaaaa000000000000000000000000000aaaaa000000000
7700770077700700000000007070aaaaa00000000000000000000000000000000000000000000000000aaa0000000000000000000000000000aaaaa000000000
70707000007007000700000070700aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa0000000000
77707770770007000000000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
000100001015011150101501015010150101501014011140121401314016140181501d15024150371503715000100001000010000100001000010000100001000010000100001000010000100001000010000100
00010000110500f0500e0500d0500c0500b0500b0500a0500a0500a05009050090500a0500a0500a0500b0500c0500d0500e0501005011050130501505017050180501a0501b0501d0502005023050270502d050
000100001c3502035022350273502b3502d35030350313502a350233501e3501c3501c3501d3501e350203502335024350233501f3501b3501b3501c3501e3502035021350213501e3501b350163501335012350
000200000101001010010000100004000050000400001600016000160001600016000160002600026000260003600036000360003600036000860008600086000860008600086000860009600000000000000000
__music__
00 01424344

